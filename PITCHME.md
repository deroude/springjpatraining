# JPA on Spring Boot Startup

### Presented for LINK

---

## Goals

- Create a Spring JPA / MySQL web enabled application
    - Use Spring Boot IoC
    - Connect to a MySQL DB
    - Use JPA Domain classes
    - Use Spring JPA repositories
    - Expose a simple HAL service for accessing data

---

## Prerequisites (Software)

- Java 8
    - JDK
    - IDE
    - Maven
- Docker

---

## Prerequisites (Knowledge)

- __Java 8__
- Maven
- __MySQL__ (or any Relation DB)
- Docker

---

## Use Case (1)

Our application needs to exchange data with a repository (in our case MySQL)

- Steps
    - Connect to the DB using a driver
    - Perform queries to access data according to the business logic
    - Translate the objects and relations manipulated between Java and the DB


---

## Use Case (2)

- Nice to have
    - Cache frequent hits on the same data
    - Break dependency on a single DB engine / language
    - Control the DB definition from a single point

---

## Object-Relational Mapping  (1)

- What does it map?
    - Tables to Objects
    - Fields to Attributes
    - Relations between Tables (Foreign Keys) to Class Relations (e.g. Composition)
    - Cursors to Iterators / Collections
    
---

## Object-Relational Mapping  (2)

- How does it help?
    - Generate queries / enforce constraints
    - Transport / Connection / Serialization management
    - Session / Transaction management

---

## Concepts

- Entity: Java representation of a Table
- Id: Marks a Primary Key field
- Basic: Java representation of a non-relationship Field
- OneToMany, ManyToOne, ManyToMany: Java representation of FK relations

---

## Start

- Navigate to the [Spring Boot Initializr resource](https://start.spring.io/)
- Select `JPA, Web, MySQL, DevTools, Rest Repositories`
- Download the `zip` file and unpack it
- `mvn clean install`
- `mvn spring-boot:run`

Yup, that simple. Now point your browser to `http//localhost:8080/`

---?code=pom.xml&lang=xml&title=pom.xml

@[14-19](Spring parent dependency)
@[27-56](Dependencies selected from Initializr)

---?code=docker-compose.yml&lang=yaml&title=docker-compose.yml

@[4](MySQL image)
@[6-12](MySQL service configuration)

---

## Start your MySQL DB

- Make sure your Docker service is running
- Run `docker-compose up` in the folder where your `docker-compose.yml` file is

---?code=src/main/resources/application.yml&lang=yaml&title=application.yaml

@[13-18](MySQL connection)
@[2-12](JPA Provider configuration)

---?code=src/main/resources/import.sql&lang=sql&title=import.sql

@[1-6](Insert users)
@[8-12](Insert articles)

---?code=src/main/java/ro/deroude/springjpatraining/domain/User.java&lang=java&title=User.java

@[17-18](This class represents a table by the name `user`
@[23-24] (The PK is the field `id`, whose value is generated by the DB engine automatically)
@[27-41] (The username, full name, role, password and status are mandatory fields)
@[43-44] (There is a table described by the entity `Article` with the FK field `author` that points to this table)

---?code=src/main/java/ro/deroude/springjpatraining/domain/Article.java&lang=java&title=Article.java

@[20-21](This class represents a table by the name `article`
@[27-29] (The PK is the field `id`, whose value is generated by the DB engine automatically)
@[31-32] (The title of the article is a mandatory field)
@[37-39] (The publish date is mapped to a timestamp in the DB; it's also mandatory)
@[41-43] (The type of article is a string type, but it can only be one of the `enum` values)
@[45-47] (The author of the article is actually a FK to the other table, `users`)

---?code=src/main/java/ro/deroude/springjpatraining/repository/UserRepository.java&lang=java&title=UserRepository.java

@[15-16](This is a `JpaRepository` for the type `User` whose PK is of type `Integer`)
@[18](Expose a method to find a user by the `username` field)
@[20-21](Find using a custom `Query` written in `JPQL`; return a `Page`, according to the provided `Pageable` specification)

---

## Task 1

Add a new Entity to the domain: `Contact`

- A `User` can have multiple `Contact` information
- An `Article` must have a single `Contact` information attached, from the `author`
- Populate the DB using the `import.sql`

---

## Task 2

Add search functionality to the `ArticleRepository`

- Find all articles whose title, text, or author full name match a search term
- Order by published date descending